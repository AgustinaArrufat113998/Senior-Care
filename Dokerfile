# -------- Stage 1: Build --------
FROM maven:3.9-eclipse-temurin-17 AS builder
WORKDIR /app
COPY pom.xml .
# Descarga dependencias en cache
RUN mvn -q -e -B dependency:go-offline
# Copia el c√≥digo
COPY src ./src
# Compila y empaqueta (salida: target/app.jar)
RUN mvn -q -e -B clean package -DskipTests && \
    cp target/*-SNAPSHOT.jar /app/app.jar || cp target/*.jar /app/app.jar

# -------- Stage 2: Runtime --------
FROM eclipse-temurin:17-jre
WORKDIR /app
# Usuario no root por seguridad
RUN useradd -r -u 10001 appuser
COPY --from=builder /app/app.jar /app/app.jar
EXPOSE 8080
USER appuser
# HEALTHCHECK opcional si usas actuator: /actuator/health
# HEALTHCHECK --interval=30s --timeout=5s --retries=3 CMD wget -qO- http://localhost:8080/actuator/health || exit 1
ENTRYPOINT ["java","-jar","/app/app.jar"]


#URL: jdbc:mysql://host.docker.internal:3306/SeniorCareDB?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
